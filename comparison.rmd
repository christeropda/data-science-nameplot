---
title: "Comparison betewen birthnames and TV Shows"
author: "Christer Hagenes Opdahl and Kim Gr√∏nning Eide"
date: "1 12 2020"
output: html_document
---

```{r setup ,include=FALSE}
library(knitr)
knitr::opts_chunk$set(echo = FALSE)
library(reticulate)
```
```{python}
# Python libraries
import requests
from bs4 import BeautifulSoup
import pandas as pd
from matplotlib import pyplot as plt
```

# About the project

The project is to look at the names of newborns in Norway and Sweden, and compare the names they get against big TV shows. We first want to compare it against a big international TV show, and see if the names of the newborns are affected by this. Then we find a big TV show for both Norway and Sweden, and check if there is any differences. We will be comparing Norwegian girls against Swedish girls, and the same with the boys. 

# Related Work
We know that there have been previous projects looking at the relation between baby names and pop culture, more specifically French names and character names from Game of Thrones. However, we do not know how these projects choose to display their statistics other than some graph system. Additionally, when searching for related work on the web, most solutions comes in the form of a list containing popular baby names but without any form of knowing the amount of babies who was given the names. This research found on the web served more to be a "what not to do" and gave us an insight of what we wanted the graphs to look like. We wanted some kind of a graph that would show the popularity of each specific name in relation to the popular series, but also in relation to each other so that each name could be weighed up against each other.

This is what lead us to the "simplicity is king" strategy. Display the yearly amount of each name in a graph containing all names, in addition to a static line on the year where the series dropped. We think that this is a good way to show the statistic, because its easy to read and you need no other information than the title of the grapich to understand what point we are trying to make.

Also instead of just analyzing one series, we choose to analyze three different series. Since the data of the names, are specific to Norway and Sweeden, we choose to analyze one globally popular series(Game of Thrones), one Norwegian series(SKAM) and one Sweedish series(Wallander). Note that the algorithm that were created can infact analyze the relationship between norwegian and sweedish baby names to any series contained on the IMDB website. This is possible since all series has the same character name display on the IMDB website,and we planned for it to be like this so we could dynamically switch out the series if we wanted to.

# Initial Questions
When we started the project initially, we were curious if the names that are used for Game of Thrones, were later seen as names for newborns in Norway and Sweden, and if any names were present before the TV show started if any names got more popular. However, when we got the results in from Game of Thrones, we realized that were few of the names were actually used. We then figured out we could look at different TV shows that were made in Norway and Sweden, and do the same analysis for those. We then got hit by the issue that for Skam in particular, some of the names were so popular that it became very hard to read the graphs. We then limited the number of characters to those that had been in the most episodes. Since the popularity of the different names are different from show to show, this limitation is also different between them. 


# Data
### Webscraping
The information about actor names, and how many episodes they were involved in, were webscraped of imdb.com. The scraping were done using python, and the libraries requests and bs4. 

### Statistics
All data used in this project, are collected from official sources in Norway and Sweden, respectively SSB and SCB(statistik databasen).
The data from both sources contains all newborn baby names from 1998 to 2019 and the amount of babies that have been given each name.
The data were originally organized as xmlx files, but we found out that while using python, converting the files to txt files were faster and easier to work with.
It becomes faster and easier because you can simply read each line in the file, searching for the character names and if found append into a list for further data wrangling.

The main hurdle to get over in this project was to convert the datasets into usable data structures that were fast and easy to access. The efficiency, were ensured by the above mentioned technique,
however, a good amount of additional wrangling were needed to make the information plot table. The source code is heavily commented and should provide good insight on what was done.

When plotting the different statistics it was important to make the data easily readable, and they had to be understandable for bystanders without additional knowledge about the project. 
There were multiple renditions, we found that simplicity was key to displaying the information, and decided to show graphs containing multiple names and showing when the series came out in the same graph. 
To limit the amount of names on each graph we simply limited the amount of episodes the different character names had to be present in the series for them to be "important" enough to be on the graph.
This was particularly important for the Norwegian series "Skam" which feature an enormous amount of character names spanning over many episodes, but a limit at 10 episodes were shown to be an efficient metric.
Note that different limits were used for different series, and that if the names plotted in the different statistics is the character names found in the newborn population of Norway and Sweden between 1998 and 2019.
This means that there might be popular character names which is not in the plots, but that means that there simply are none that was named that in the period from 1998 to 2019.


```{python}
#Webscrapping of imdb. based on reading TV shows. 
def get_dataset(url, limiter):
    r = requests.get(url)
    soup = BeautifulSoup(r.content, 'html.parser')
    castlist = []
    # Find the different characters in the TV show
    for td in soup.findAll('td', class_='character'):
        episode = td.text.split('\n')[2].strip().split(" ")[0]
        # A fix for some inconsistencies in how the imdb template is rendered.
        if '/ ...' in td.text:
            episode = td.text.split('\n')[3].strip().split(" ")[0]
            
        name = td.text.split('\n')[1]

          # If we have surpased the amount of episodes we want to se, break of
        if int(episode) < limiter:
            break

        castlist.append(name.strip())

    
    return castlist
    
    
# Removes the same surname or first names of characters
# Blacklist is for the name that will not be added in the list.
def split_and_remove_dup(names, blacklist):
    res = []
    
    for i in names:
          # Break the full character name into individual names,
          # and iterate through them
        diff = i.split(" ")
        for j in diff:
            if j not in res and j not in blacklist:
                res.append(j)
    
    return res
```

```{python}
def find_names_swe(filename, charlist):
    info = []
    
    with open(filename, "r") as f:
        data = f.readline()
        while(data):
            name = data.split(",")[0].strip()
            if name in charlist:
                info.append(data.replace("-", "0").strip("\n"))

            data = f.readline()

    return info

def find_names_nor(filename, charlist):
    info = []

    with open(filename, "r") as f:
        data = f.readline()
        while(data):
            name = data.split(";")[0].strip('"').strip()
            if name in charlist:
                # Removing newline character, and fixing the format of the data. 
                info_add = data.strip('\n').strip(',').strip('"')
                info.append(info_add.replace('.', '0').replace(';', ','))

            data = f.readline()
    

    return info
```

```{python}
def plot(names_sweden, names_norway, gender, title, start):
    years = list(range(1998,2020))
    numbers = []
    plt.figure(figsize=(12, 4))
    
    plt.subplot(1, 2, 1)
    for i in names_sweden:
        name = i.split(",")[0]
        chars = i.split(",")[1:]

        j = 0	
        while j < len(chars):
            if '"' in chars[j]:
                appendthis = chars[j].strip('"') + chars[j+1].strip('"')
                numbers.append(int(appendthis))
                j += 2
                continue

            numbers.append(int(chars[j]))
            j += 1

        plt.plot(years, numbers, label=name.strip('"'))
        plt.legend(loc="upper left")
        numbers.clear()
    
    plt.axvline(x=start)
    plt.title("{}, {} baby names in Sweden".format(title, gender))
    
    plt.subplot(1, 2, 2)
    numbers.clear()
    for i in names_norway:
        name = i.split(",")[0]
        chars = i.split(",")[1:]

        j = 0	
        while j < len(chars):
            if '"' in chars[j]:
                appendthis = chars[j].strip('"') + chars[j+1].strip('"')
                numbers.append(int(appendthis))
                j += 2
                continue

            numbers.append(int(chars[j]))
            j += 1

        plt.plot(years, numbers, label=name.strip('"'))
        plt.legend(loc="upper left")
        numbers.clear()
    
    plt.axvline(x=start)
    plt.title("{}, {} baby names in Norway".format(title, gender))

    plt.show()
    plt.close()
```


```{python}
# blacklisted words from Game of Thrones, Skam and Wallander
blacklist_got = ["High", "The", "King", "Night", "Night's", 'Watch', "Officer", "Black", "Septa"]
blacklist_skam = []
blacklist_wallander = []

# Webscarpe IMDB for the character names
castlist_got = get_dataset('https://www.imdb.com/title/tt0944947/fullcredits?ref_=tt_cl_sm#cast', 3)
castlist_skam = get_dataset('https://www.imdb.com/title/tt5288312/fullcredits?ref_=tt_cl_sm#cast', 20)
castlist_wallander = get_dataset('https://www.imdb.com/title/tt0907702/fullcredits?ref_=tt_cl_sm#cast', 5)

# Seperate all the different names
names_skam = split_and_remove_dup(castlist_skam, blacklist_skam)
names_got = split_and_remove_dup(castlist_got, blacklist_got)
names_wallander = split_and_remove_dup(castlist_wallander, blacklist_wallander)

# Read the database for girls and boys names for both norway and sweden. 
swe_got_girls = find_names_swe("sweden_girl_names.csv", names_got)
swe_got_boys = find_names_swe("sweden_boy_names.csv", names_got)

nor_got_girls = find_names_nor("norway_girl_names.csv", names_got)
nor_got_boys = find_names_nor("norway_boy_names.csv", names_got)


swe_skam_girls = find_names_swe("sweden_girl_names.csv", names_skam)
swe_skam_boys = find_names_swe("sweden_boy_names.csv", names_skam)

nor_skam_girls = find_names_nor("norway_girl_names.csv", names_skam)
nor_skam_boys = find_names_nor("norway_boy_names.csv", names_skam)


swe_wallander_girls = find_names_swe("sweden_girl_names.csv", names_wallander)
swe_wallander_boys = find_names_swe("sweden_boy_names.csv", names_wallander)

nor_wallander_girls = find_names_nor("norway_girl_names.csv", names_wallander)
nor_wallander_boys = find_names_nor("norway_boy_names.csv", names_wallander)
```


```{python}
# Plot the figures for Game of Thrones
plot(swe_got_girls, nor_got_girls, 'girls', 'Game of Thrones', 2011)

plot(swe_got_boys, nor_got_boys, 'boys', 'Game of Thrones', 2011)
```

```{python}
# Plot the figures for Game of Thrones
plot(swe_skam_girls, nor_skam_girls, 'girls', 'Skam', 2015)

plot(swe_skam_boys, nor_skam_boys, 'boys', 'Skam', 2015)
```

```{python}
# Plot the figures for Game of Thrones
plot(swe_wallander_girls, nor_wallander_girls, 'girls', 'Wallander', 2008)

plot(swe_wallander_boys, nor_wallander_boys, 'boys', 'Wallander', 2008)
```


# Exploratory Analysis
We decided to show the data as a graph, where the number of newborns for each year for each country is shown in different graphs. We did initially want to show all names for one country in the same graph, but the graphs became unreadable because of all the information in them. We also looked into different plot methods, but in the end we came to the conclusion that a bar graph displays the different changes overtime better than the other charts we did look into. When reading the graphs, since we were interested in any changes after a show started, we added a vertical line to easier display the difference before and after to see if anything changed. 

The data we have could of course be displayed in a table, with the different numbers in cells next to each other. However, we decided not to go this route as we found the graph to be more readable for changes overtime, which is what we were aiming for. Our project started initially with only looking at Game of Thrones, but we felt there was a lack of data to read from this, therefore we decided to add in more TV shows, which is more based around Sweden and Norway to see if these countries had their name choices inspired by the TV show or not. 

# Final Analysis
The results show that there are some increase in baby names after popular series aired, but very few, and there might need to be an additional discussion if the series itself were the main reason for the increase. 
Many of the names that became more popular after the series aired, seems to already be increasing in popularity before the different shows came out, which also might be the reason for the names being in the series in the first place.
This is very evident in the plots from the norwegian series "Skam" and the Swedish series "Wallander". With that said, there is also evidence that points to names being directly linked to the different shows, such as Game Of Thrones.
But the statistics is not similar between the two different countries. In Sweden the names grew a lot in popularity in the years following, but in Norway there were no girl names from the show evident in the data.
For example Arya, which arguably are the most popular name from Game Of thrones, are not given to a single newborn baby from 1998 to 2019. However, when looking further into the data, there were some influx of "Norwegianized" spelling
of the names such as "Aria". This is however not shown in the plotted statistics, and is not a trivial thing to do either.
